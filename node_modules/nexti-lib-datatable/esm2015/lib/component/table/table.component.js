import { CurrencyPipe } from '@angular/common';
import { Component, Input, Output, EventEmitter, } from '@angular/core';
var NumberFormat;
(function (NumberFormat) {
    NumberFormat["NUM"] = "number";
    NumberFormat["CUR"] = "currency";
})(NumberFormat || (NumberFormat = {}));
var FormatType;
(function (FormatType) {
    FormatType["NUM"] = "number";
    FormatType["CUR"] = "currency";
    FormatType["COU"] = "count";
})(FormatType || (FormatType = {}));
var OperationFormat;
(function (OperationFormat) {
    OperationFormat["SUM"] = "suma";
    OperationFormat["RES"] = "resta";
})(OperationFormat || (OperationFormat = {}));
export class TableComponent {
    constructor(currencyPipe) {
        this.currencyPipe = currencyPipe;
        this.paginacion = false;
        this.totalRegistros = 0;
        this.actualPage = 0;
        this.multFPP = 0;
        this.onNext = new EventEmitter();
        this.onReturn = new EventEmitter();
        this.onDelete = new EventEmitter();
        this.onUpdate = new EventEmitter();
        this.onActive = new EventEmitter();
        this.onShow = new EventEmitter();
        this.onShowEvent = new EventEmitter();
        this.footerRow = [];
        this.dataPerm$ = new Array();
        this.observableBtnDelete$ = false;
        this.observableBtnUpdate$ = false;
        this.observableBtnActive = false;
        this.filas = [];
        this.filasPorPagina = 0;
    }
    ngOnChanges(changes) {
        const { data$, recursos } = changes;
        if ((data$ === null || data$ === void 0 ? void 0 : data$.currentValue) !== (data$ === null || data$ === void 0 ? void 0 : data$.previousValue)) {
            this.dataPerm$ = data$ === null || data$ === void 0 ? void 0 : data$.currentValue;
        }
        if ((recursos === null || recursos === void 0 ? void 0 : recursos.currentValue) !== (recursos === null || recursos === void 0 ? void 0 : recursos.previousValue)) {
            this.observableBtnUpdate$ = this.recursos.update;
            this.observableBtnDelete$ = this.recursos.delete;
            this.observableBtnActive = this.recursos.active;
        }
    }
    ngOnInit() {
        this.orderHeaderStatus = this.header.map((h) => false);
        if (this.paginacion && this.multFPP != 0) {
            this.calcFilasPorPagina();
        }
        else if (this.paginacion && this.multFPP === 0) {
            this.filasPorPagina = 10;
            this.filas.push(10);
        }
    }
    calcFilasPorPagina() {
        let cantidadFilas = 0;
        for (let index = 0; index < 10; index++) {
            cantidadFilas = cantidadFilas + this.multFPP;
            this.filas.push(cantidadFilas);
        }
        this.filasPorPagina = this.filas[0];
    }
    paginaSiguiente() {
        this.onNext.emit(this.filasPorPagina);
    }
    paginaAnterior() {
        this.onReturn.emit(this.filasPorPagina);
    }
    onOrderColumn(head, index) {
        const orderStatus = this.orderHeaderStatus[index];
        this.orderHeaderStatus[index] = !orderStatus;
        this.data$ = this.dataPerm$.sort((_, b) => {
            if (typeof _[index] === 'object') {
                if (_[index].title) {
                    if (_[index].title > b[index].title) {
                        return orderStatus ? 1 : -1;
                    }
                    if (_[index].title < b[index].title) {
                        return orderStatus ? -1 : 1;
                    }
                    return 0;
                }
                if (b[index].subtitle) {
                    if (_[index].subtitle > b[index].subtitle) {
                        return orderStatus ? 1 : -1;
                    }
                    if (_[index].subtitle < b[index].subtitle) {
                        return orderStatus ? -1 : 1;
                    }
                    return 0;
                }
            }
            else {
                if (_[index] > b[index]) {
                    return orderStatus ? 1 : -1;
                }
                if (_[index] < b[index]) {
                    return orderStatus ? -1 : 1;
                }
                return 0;
            }
        });
    }
    getFooterData() {
        var _a;
        const { customTotalTitle, customTotalRows, customTotalFormatting, customTotalType, customTotalAlign, customTotalFixed, customOperationFormatting, } = this.footerConfig;
        let tableFooterData = [];
        let rawData = [];
        (_a = this.data$) === null || _a === void 0 ? void 0 : _a.forEach((itemArray) => {
            let rawDataRow = [];
            // Step 1: format - prepare dat
            const formatedData = itemArray.map((item) => this.getFormatDataToTreatment(item));
            // Step 2: Get raw data (values to totals)
            this.getRawData(customTotalRows, formatedData, customTotalType, rawDataRow);
            rawData.push(rawDataRow);
        });
        if (customTotalRows && customTotalRows.length && rawData.length) {
            let procesedTotals = [];
            switch (customOperationFormatting) {
                case OperationFormat.RES:
                    procesedTotals = this.trasposeMatrix(rawData).map((itemArray) => {
                        return itemArray.reduce((a, b) => a - b);
                    });
                    break;
                default:
                    procesedTotals = this.trasposeMatrix(rawData).map((itemArray) => itemArray.reduce((a, b) => a + b, 0));
                    break;
            }
            if (customTotalFormatting && customTotalFormatting.length) {
                procesedTotals = customTotalFormatting.map((format, index) => {
                    let value, align, fixed, less;
                    switch (format) {
                        case NumberFormat.CUR:
                            value = this.currencyPipe.transform(procesedTotals[index]);
                            break;
                        default:
                            value = procesedTotals[index];
                            break;
                    }
                    align = customTotalAlign[index];
                    fixed = customTotalFixed[index];
                    less = procesedTotals[index] <= -1;
                    return {
                        value,
                        align,
                        fixed,
                        less,
                    };
                });
            }
            tableFooterData = procesedTotals.length ? procesedTotals : null;
        }
        let finalFooterData = [];
        // Clear data
        if (customTotalRows && customTotalRows.length) {
            let cont = 0;
            for (let i = 0; i < this.header.length; i++) {
                let itemToPush;
                customTotalRows.forEach((customIndex) => {
                    if (customIndex === i) {
                        itemToPush = tableFooterData[cont];
                        cont++;
                    }
                });
                if (i === 0 && customTotalTitle) {
                    itemToPush = {
                        fixed: 'td-sticky-left title-total',
                        value: customTotalTitle,
                    };
                }
                if (this.header.length === i + 1 && !this.hiddenActions) {
                    itemToPush = { fixed: 'td-sticky-right' };
                }
                finalFooterData.push(itemToPush);
            }
        }
        this.footerRow = finalFooterData;
    }
    formatCurrencyToNumber(value) {
        if (value !== undefined && value !== null)
            return Number(String(value).replace(/[^0-9.-]+/g, ''));
    }
    trasposeMatrix(matrix) {
        return matrix[0].map((_, colIndex) => matrix.map((row) => row[colIndex]));
    }
    toggleFilterClass(index) {
        return `bi ${this.orderHeaderStatus[index] ? 'bi-caret-up-fill' : 'bi-caret-down-fill'} icon-order`;
    }
    isObject(val) {
        return typeof val === 'object';
    }
    getRawData(customTotalRows, formatedData, customTotalType, rawDataRow) {
        if (customTotalRows && customTotalRows.length) {
            customTotalRows.forEach((customIndex, indexCol) => {
                formatedData.forEach((item, index) => {
                    if (customIndex === index) {
                        let returnItem = 0;
                        customTotalType.forEach((type, indexType) => {
                            if (indexCol === indexType) {
                                switch (type) {
                                    case FormatType.NUM:
                                        if ((typeof item === 'string' &&
                                            (item == '--' || item === '')) ||
                                            typeof item === 'undefined') {
                                            returnItem = 0;
                                        }
                                        else {
                                            returnItem = Number(item);
                                        }
                                        break;
                                    case FormatType.CUR:
                                        if ((typeof item === 'string' &&
                                            (item == '--' || item === '')) ||
                                            typeof item === 'undefined') {
                                            returnItem = 0;
                                        }
                                        else {
                                            returnItem = this.formatCurrencyToNumber(item);
                                        }
                                        break;
                                    case FormatType.COU:
                                        if ((typeof item === 'string' &&
                                            (item == '--' || item === '')) ||
                                            typeof item === 'undefined') {
                                            returnItem = 0;
                                        }
                                        else {
                                            returnItem = 1;
                                        }
                                        break;
                                    default:
                                        returnItem = 0;
                                }
                            }
                        });
                        rawDataRow.push(returnItem);
                    }
                });
            });
        }
    }
    getFormatDataToTreatment(item) {
        if (typeof item === 'object') {
            if (item != null) {
                if (item.title && item.subtitle) {
                    return `${item.title}\n${item.subtitle}`;
                }
                else {
                    return item.title ? item.title : item.subtitle && item.subtitle;
                }
            }
            else {
                return '';
            }
        }
        else {
            return item;
        }
    }
    onDeleteItem(item) {
        this.onDelete.emit(item);
    }
    onActiveItem(item) {
        this.onActive.emit(item);
    }
    onUpdateItem(item) {
        this.onUpdate.emit(item);
    }
    onShowItem(item, $event) {
        this.onShow.emit(item);
        this.onShowEvent.emit($event);
    }
}
TableComponent.decorators = [
    { type: Component, args: [{
                selector: 'nexti-lib-table',
                template: "<div class=\"content-table\">\r\n  <div class=\"content-body table-responsive\">\r\n    <table [attr.aria-label]=\"title\" aria class=\"table\" id=\"table\">\r\n      <thead class=\"table-head\">\r\n        <tr>\r\n          <ng-container *ngFor=\"let head of header; index as i\">\r\n            <ng-container *ngIf=\"isObject(head); else thsimple\">\r\n              <ng-container *ngIf=\"head?.fixedLeft === true\">\r\n                <th\r\n                  scope=\"col\"\r\n                  [ngClass]=\"{\r\n                    'th-sticky-left': true,\r\n                    alignEnd: head?.alignEnd\r\n                  }\"\r\n                >\r\n                  <div class=\"thflex\">\r\n                    <span>{{ head.title }}</span>\r\n                    <ng-container *ngIf=\"head?.order === true\">\r\n                      <i\r\n                        aria-hidden=\"true\"\r\n                        [class]=\"toggleFilterClass(i)\"\r\n                        (click)=\"onOrderColumn(head, i)\"\r\n                      ></i>\r\n                    </ng-container>\r\n                  </div>\r\n                </th>\r\n              </ng-container>\r\n              <ng-container *ngIf=\"head?.fixedRight === true\">\r\n                <th\r\n                  scope=\"col\"\r\n                  [ngClass]=\"{\r\n                    'th-sticky-right': true,\r\n                    alignEnd: head?.alignEnd\r\n                  }\"\r\n                >\r\n                  <div class=\"thflex\">\r\n                    <span>{{ head.title }}</span>\r\n                    <ng-container *ngIf=\"head?.order === true\">\r\n                      <i\r\n                        aria-hidden=\"true\"\r\n                        [class]=\"toggleFilterClass(i)\"\r\n                        (click)=\"onOrderColumn(head, i)\"\r\n                      ></i>\r\n                    </ng-container>\r\n                  </div>\r\n                </th>\r\n              </ng-container>\r\n              <ng-container *ngIf=\"!head?.fixedRight && !head?.fixedLeft\">\r\n                <th scope=\"col\">\r\n                  <div\r\n                    class=\"thflex\"\r\n                    [ngClass]=\"{\r\n                      alignEnd: head?.alignEnd\r\n                    }\"\r\n                  >\r\n                    <span>{{ head.title }}</span>\r\n                    <ng-container *ngIf=\"head?.order === true\">\r\n                      <i\r\n                        aria-hidden=\"true\"\r\n                        [class]=\"toggleFilterClass(i)\"\r\n                        (click)=\"onOrderColumn(head, i)\"\r\n                      ></i>\r\n                    </ng-container>\r\n                  </div>\r\n                </th>\r\n              </ng-container>\r\n            </ng-container>\r\n            <ng-template #thsimple>\r\n              <th scope=\"col\">\r\n                <span>{{ head }}</span>\r\n              </th>\r\n            </ng-template>\r\n          </ng-container>\r\n        </tr>\r\n      </thead>\r\n      <ng-container *ngIf=\"data$ && data$.length > 0\">\r\n        <tbody class=\"table-body\">\r\n          <tr *ngFor=\"let list of data$\">\r\n            <ng-container *ngFor=\"let item of list\">\r\n              <ng-container *ngIf=\"!item?.hidden\">\r\n                <ng-container *ngIf=\"isObject(item); else tdsimple\">\r\n                  <ng-container\r\n                    *ngIf=\"item?.fixedLeft || item?.fixedRight; else tdsimple\"\r\n                  >\r\n                    <ng-container\r\n                      *ngIf=\"item?.fixedLeft === true; else tdfixedright\"\r\n                    >\r\n                      <td\r\n                        [ngClass]=\"{\r\n                          'td-sticky-left': true,\r\n                          alignEnd: item?.alignEnd ? true : false\r\n                        }\"\r\n                      >\r\n                        <ng-container *ngIf=\"item?.title\">\r\n                          <a\r\n                            href=\"#\"\r\n                            *ngIf=\"item.link\"\r\n                            (click)=\"onShowItem(item, $event)\"\r\n                            data-bs-toggle=\"modal\"\r\n                            data-bs-target=\"#exampleModal\"\r\n                            [attr.data-id]=\"item?.title\"\r\n                            >{{ item?.title }}</a\r\n                          >\r\n                          <span\r\n                            [ngClass]=\"{\r\n                              title: item.link,\r\n                              warn: formatCurrencyToNumber(item?.title) <= -1\r\n                            }\"\r\n                            *ngIf=\"!item?.link\"\r\n                            >{{ item?.title }}</span\r\n                          >\r\n                        </ng-container>\r\n                        <ng-container *ngIf=\"item?.title && item?.subtitle\">\r\n                          <br />\r\n                        </ng-container>\r\n                        <ng-container *ngIf=\"item?.subtitle\">\r\n                          <span\r\n                            class=\"subtitle\"\r\n                            [ngClass]=\"{\r\n                              warn: formatCurrencyToNumber(item?.subtitle) <= -1\r\n                            }\"\r\n                            >{{ item?.subtitle }}</span\r\n                          >\r\n                        </ng-container>\r\n                      </td>\r\n                    </ng-container>\r\n                    <ng-template #tdfixedright>\r\n                      <td\r\n                        [ngClass]=\"{\r\n                          'td-sticky-right': true,\r\n                          alignEnd: item?.alignEnd ? true : false\r\n                        }\"\r\n                      >\r\n                        <ng-container *ngIf=\"item?.title\">\r\n                          <a\r\n                            href=\"#\"\r\n                            *ngIf=\"item.link\"\r\n                            (click)=\"onShowItem(item, $event)\"\r\n                            data-bs-toggle=\"modal\"\r\n                            data-bs-target=\"#exampleModal\"\r\n                            [attr.data-id]=\"item?.title\"\r\n                            >{{ item?.title }}</a\r\n                          >\r\n                          <span\r\n                            [ngClass]=\"{\r\n                              title: item.link,\r\n                              warn: formatCurrencyToNumber(item?.title) <= -1\r\n                            }\"\r\n                            *ngIf=\"!item?.link\"\r\n                            >{{ item?.title }}</span\r\n                          >\r\n                        </ng-container>\r\n                        <ng-container *ngIf=\"item?.title && item?.subtitle\">\r\n                          <br />\r\n                        </ng-container>\r\n                        <ng-container *ngIf=\"item?.subtitle\">\r\n                          <span\r\n                            class=\"subtitle\"\r\n                            [ngClass]=\"{\r\n                              warn: formatCurrencyToNumber(item?.subtitle) <= -1\r\n                            }\"\r\n                            >{{ item?.subtitle }}</span\r\n                          >\r\n                        </ng-container>\r\n                      </td>\r\n                    </ng-template>\r\n                  </ng-container>\r\n                  <ng-template #tdsimple>\r\n                    <td\r\n                      [ngClass]=\"{\r\n                        alignEnd: item?.alignEnd ? true : false\r\n                      }\"\r\n                    >\r\n                      <a\r\n                        href=\"#\"\r\n                        *ngIf=\"item?.link\"\r\n                        (click)=\"onShowItem(item, $event)\"\r\n                        data-bs-toggle=\"modal\"\r\n                        data-bs-target=\"#exampleModal\"\r\n                        [attr.data-id]=\"item?.title\"\r\n                        >{{ item?.title }}</a\r\n                      >\r\n                      <span\r\n                        [ngClass]=\"{\r\n                          title: item.link,\r\n                          warn: formatCurrencyToNumber(item?.title) <= -1\r\n                        }\"\r\n                        *ngIf=\"!item?.link\"\r\n                        >{{ item?.title }}</span\r\n                      >\r\n                      <br /><span\r\n                        class=\"subtitle\"\r\n                        [ngClass]=\"{\r\n                          warn: formatCurrencyToNumber(item?.subtitle) <= -1\r\n                        }\"\r\n                        >{{ item?.subtitle }}</span\r\n                      >\r\n                    </td>\r\n                  </ng-template>\r\n                </ng-container>\r\n                <ng-template #tdsimple>\r\n                  <td\r\n                    [ngClass]=\"{\r\n                      warn: formatCurrencyToNumber(item) <= -1\r\n                    }\"\r\n                  >\r\n                    {{ item }}\r\n                  </td>\r\n                </ng-template>\r\n              </ng-container>\r\n            </ng-container>\r\n            <ng-container *ngIf=\"!hiddenActions\">\r\n              <td class=\"td-sticky-right\">\r\n                <ng-container *ngIf=\"observableBtnUpdate$ && !actionState\">\r\n                  <a\r\n                    class=\"icon-actions\"\r\n                    (click)=\"onUpdateItem(list)\"\r\n                    data-bs-toggle=\"modal\"\r\n                    data-bs-target=\"#exampleModal\"\r\n                    ><i\r\n                      aria-hidden=\"true\"\r\n                      class=\"bi bi-pencil-square secondary\"\r\n                    ></i\r\n                  ></a>\r\n                </ng-container>\r\n                <ng-container *ngIf=\"observableBtnDelete$ && !actionState\">\r\n                  <a class=\"icon-actions\" (click)=\"onDeleteItem(list)\"\r\n                    ><i aria-hidden=\"true\" class=\"bi bi-trash primary\"></i\r\n                  ></a>\r\n                </ng-container>\r\n                <ng-container *ngIf=\"observableBtnActive && actionState\">\r\n                  <button\r\n                    (click)=\"onActiveItem(list)\"\r\n                    type=\"button\"\r\n                    class=\"btn btn-primary\"\r\n                  >\r\n                    Activar\r\n                  </button>\r\n                </ng-container>\r\n              </td>\r\n            </ng-container>\r\n          </tr>\r\n        </tbody>\r\n        <tfoot *ngIf=\"footerConfig\">\r\n          <tr>\r\n            <ng-container *ngFor=\"let item of footerRow\">\r\n              <td\r\n                [classList]=\"item?.fixed\"\r\n                [ngClass]=\"{ warn: item?.less }\"\r\n                [style]=\"item?.align\"\r\n              >\r\n                {{ item?.value }}\r\n              </td>\r\n            </ng-container>\r\n          </tr>\r\n        </tfoot>\r\n      </ng-container>\r\n    </table>\r\n    <div class=\"emptyContent\" *ngIf=\"!data$ || data$.length === 0\">\r\n      <ng-container *ngIf=\"!isLoading\">\r\n        <img class=\"icon-empty\" src=\"./assets/icons/empty.svg\" alt=\"empty\" />\r\n        <h6>{{ titleEmpty }}</h6>\r\n      </ng-container>\r\n    </div>\r\n  </div>\r\n  <div\r\n    class=\"content-footer d-flex justify-content-end pt-3\"\r\n    *ngIf=\"!opOcultarFooter\"\r\n  >\r\n    <ng-container *ngIf=\"data$?.length !== undefined\">\r\n      <ng-container *ngIf=\"paginacion; else comunfooter\">\r\n        <div class=\"d-flex w-50 justify-content-end align-items-start\">\r\n          <div class=\"d-flex flex-row align-items-center\">\r\n            <h6 class=\"text-size-sm muted mx-2 mb-0\">Filas por p\u00E1gina:</h6>\r\n            <select\r\n              class=\"form-select custom-select\"\r\n              [(ngModel)]=\"filasPorPagina\"\r\n            >\r\n              <option *ngFor=\"let item of filas\" value=\"{{ item }}\">\r\n                {{ item }}\r\n              </option>\r\n            </select>\r\n            <h6 class=\"text-size-sm muted mx-2 mb-0 text-end\">\r\n              {{\r\n                data$.length ? data$.length * actualPage - data$.length + 1 : 0\r\n              }}\r\n              - {{ actualPage * data$?.length }} de\r\n              {{ totalRegistros }}\r\n            </h6>\r\n            <div class=\"\">\r\n              <i\r\n                class=\"bi bi-chevron-left mx-2 custom-chevron\"\r\n                aria-hidden=\"true\"\r\n                (click)=\"paginaAnterior()\"\r\n              ></i>\r\n              <i\r\n                class=\"bi bi-chevron-right custom-chevron\"\r\n                aria-hidden=\"true\"\r\n                (click)=\"paginaSiguiente()\"\r\n              ></i>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      </ng-container>\r\n      <ng-template #comunfooter>\r\n        <h6 class=\"text-size-sm muted\">\r\n          Mostrando {{ data$?.length }} registros\r\n        </h6>\r\n      </ng-template>\r\n    </ng-container>\r\n  </div>\r\n</div>\r\n",
                styles: ["@import \"https://cdn.jsdelivr.net/npm/bootstrap-icons@1.5.0/font/bootstrap-icons.css\";tfoot{position:sticky;bottom:0;z-index:2}tfoot td{border-collapse:initial;border-top:2px solid #0f1b32!important}.thflex{display:flex;flex-direction:row;align-items:center;justify-content:space-between}.alignEnd{justify-content:flex-end;text-align:end}.table-responsive{width:100%;overflow:auto}.table{width:100%;border-spacing:0}.table,.table-head{border-collapse:initial}.table-head{position:sticky;top:0;z-index:2}.table-head th{border-bottom:2px solid #0f1b32!important}.table-body,.table-body td,.table-head th{border-collapse:initial}.table-body td{border-bottom:1px solid #e4e9ef!important}.primary{color:#0f1b32}.secondary{color:#2a8bf2}.icon-order{cursor:pointer;padding-left:10px}th{font-weight:700;color:#0f1b32;vertical-align:middle}td,th{font-size:12px;line-height:17px;width:auto;height:50px;min-width:150px;max-width:200px;background-color:#fff}td{font-weight:500;color:#585858}.title{color:#2a8bf2}.title-total{font-weight:700}.subtitle{text-transform:uppercase}.icon-actions{font-size:15px;cursor:pointer;color:#585858}.icon-actions:nth-child(2){margin-left:15px}.text-size-sm{font-size:12px;min-width:100px}.th-sticky-left{position:sticky;left:0;z-index:3}.th-sticky-right{position:sticky;right:0;z-index:3}.td-sticky-left{position:sticky;left:0;z-index:1}.td-sticky-right{position:sticky;right:0;z-index:1}.emptyContent{position:sticky;left:0;right:0;width:100%;min-height:200px;display:flex;flex-direction:column;justify-content:center;align-items:center}h6{color:#0f1b32;font-weight:700!important}.icon-empty{font-size:75px}.warn{color:#eb5757!important}.content-table{display:grid;width:100%;height:100%;grid-template-rows:auto 1fr;grid-template-areas:\"content-body\" \"content-footer\"}.content-body{grid-area:content-body}.content-footer{grid-area:content-footer}.custom-select{padding:5px;width:60px;max-width:60px;min-width:60px}.custom-chevron{cursor:pointer}"]
            },] }
];
TableComponent.ctorParameters = () => [
    { type: CurrencyPipe }
];
TableComponent.propDecorators = {
    title: [{ type: Input }],
    titleEmpty: [{ type: Input }],
    header: [{ type: Input }],
    data$: [{ type: Input }],
    footerConfig: [{ type: Input }],
    recursos: [{ type: Input }],
    actionState: [{ type: Input }],
    opOcultarFooter: [{ type: Input }],
    hiddenActions: [{ type: Input }],
    isLoading: [{ type: Input }],
    paginacion: [{ type: Input }],
    totalRegistros: [{ type: Input }],
    actualPage: [{ type: Input }],
    multFPP: [{ type: Input }],
    onNext: [{ type: Output }],
    onReturn: [{ type: Output }],
    onDelete: [{ type: Output }],
    onUpdate: [{ type: Output }],
    onActive: [{ type: Output }],
    onShow: [{ type: Output }],
    onShowEvent: [{ type: Output }]
};
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidGFibGUuY29tcG9uZW50LmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vLi4vLi4vLi4vLi4vcHJvamVjdHMvbmV4dGktbGliLWRhdGF0YWJsZS9zcmMvbGliL2NvbXBvbmVudC90YWJsZS90YWJsZS5jb21wb25lbnQudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsT0FBTyxFQUFFLFlBQVksRUFBRSxNQUFNLGlCQUFpQixDQUFDO0FBQy9DLE9BQU8sRUFDTCxTQUFTLEVBQ1QsS0FBSyxFQUNMLE1BQU0sRUFFTixZQUFZLEdBQ2IsTUFBTSxlQUFlLENBQUM7QUFFdkIsSUFBSyxZQUdKO0FBSEQsV0FBSyxZQUFZO0lBQ2YsOEJBQWMsQ0FBQTtJQUNkLGdDQUFnQixDQUFBO0FBQ2xCLENBQUMsRUFISSxZQUFZLEtBQVosWUFBWSxRQUdoQjtBQUVELElBQUssVUFJSjtBQUpELFdBQUssVUFBVTtJQUNiLDRCQUFjLENBQUE7SUFDZCw4QkFBZ0IsQ0FBQTtJQUNoQiwyQkFBYSxDQUFBO0FBQ2YsQ0FBQyxFQUpJLFVBQVUsS0FBVixVQUFVLFFBSWQ7QUFFRCxJQUFLLGVBR0o7QUFIRCxXQUFLLGVBQWU7SUFDbEIsK0JBQVksQ0FBQTtJQUNaLGdDQUFhLENBQUE7QUFDZixDQUFDLEVBSEksZUFBZSxLQUFmLGVBQWUsUUFHbkI7QUFPRCxNQUFNLE9BQU8sY0FBYztJQStCekIsWUFBb0IsWUFBMEI7UUFBMUIsaUJBQVksR0FBWixZQUFZLENBQWM7UUFwQnJDLGVBQVUsR0FBYSxLQUFLLENBQUM7UUFDN0IsbUJBQWMsR0FBWSxDQUFDLENBQUM7UUFDNUIsZUFBVSxHQUFZLENBQUMsQ0FBQztRQUN4QixZQUFPLEdBQVksQ0FBQyxDQUFDO1FBQ3BCLFdBQU0sR0FBRyxJQUFJLFlBQVksRUFBTyxDQUFDO1FBQ2pDLGFBQVEsR0FBRyxJQUFJLFlBQVksRUFBTyxDQUFDO1FBQ25DLGFBQVEsR0FBRyxJQUFJLFlBQVksRUFBTyxDQUFDO1FBQ25DLGFB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UztRQUNwQixJQUFJLENBQUMsUUFBUSxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsQ0FBQztJQUMzQixDQUFDO0lBRUQsVUFBVSxDQUFDLElBQVMsRUFBRSxNQUFXO1FBQy9CLElBQUksQ0FBQyxNQUFNLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxDQUFDO1FBQ3ZCLElBQUksQ0FBQyxXQUFXLENBQUMsSUFBSSxDQUFDLE1BQU0sQ0FBQyxDQUFDO0lBQ2hDLENBQUM7OztZQXhVRixTQUFTLFNBQUM7Z0JBQ1QsUUFBUSxFQUFFLGlCQUFpQjtnQkFDM0Isc2hhQUFxQzs7YUFFdEM7OztZQTdCUSxZQUFZOzs7b0JBK0JsQixLQUFLO3lCQUNMLEtBQUs7cUJBQ0wsS0FBSztvQkFDTCxLQUFLOzJCQUNMLEtBQUs7dUJBQ0wsS0FBSzswQkFDTCxLQUFLOzhCQUNMLEtBQUs7NEJBQ0wsS0FBSzt3QkFDTCxLQUFLO3lCQUNMLEtBQUs7NkJBQ0wsS0FBSzt5QkFDTCxLQUFLO3NCQUNMLEtBQUs7cUJBQ0wsTUFBTTt1QkFDTixNQUFNO3VCQUNOLE1BQU07dUJBQ04sTUFBTTt1QkFDTixNQUFNO3FCQUNOLE1BQU07MEJBQ04sTUFBTSIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IEN1cnJlbmN5UGlwZSB9IGZyb20gJ0Bhbmd1bGFyL2NvbW1vbic7XHJcbmltcG9ydCB7XHJcbiAgQ29tcG9uZW50LFxyXG4gIElucHV0LFxyXG4gIE91dHB1dCxcclxuICBTaW1wbGVDaGFuZ2VzLFxyXG4gIEV2ZW50RW1pdHRlcixcclxufSBmcm9tICdAYW5ndWxhci9jb3JlJztcclxuXHJcbmVudW0gTnVtYmVyRm9ybWF0IHtcclxuICBOVU0gPSAnbnVtYmVyJyxcclxuICBDVVIgPSAnY3VycmVuY3knLFxyXG59XHJcblxyXG5lbnVtIEZvcm1hdFR5cGUge1xyXG4gIE5VTSA9ICdudW1iZXInLFxyXG4gIENVUiA9ICdjdXJyZW5jeScsXHJcbiAgQ09VID0gJ2NvdW50JyxcclxufVxyXG5cclxuZW51bSBPcGVyYXRpb25Gb3JtYXQge1xyXG4gIFNVTSA9ICdzdW1hJyxcclxuICBSRVMgPSAncmVzdGEnLFxyXG59XHJcblxyXG5AQ29tcG9uZW50KHtcclxuICBzZWxlY3RvcjogJ25leHRpLWxpYi10YWJsZScsXHJcbiAgdGVtcGxhdGVVcmw6ICcuL3RhYmxlLmNvbXBvbmVudC5odG1sJyxcclxuICBzdHlsZVVybHM6IFsnLi90YWJsZS5jb21wb25lbnQuc2FzcyddLFxyXG59KVxyXG5leHBvcnQgY2xhc3MgVGFibGVDb21wb25lbnQge1xyXG4gIEBJbnB1dCgpIHRpdGxlOiBhbnk7XHJcbiAgQElucHV0KCkgdGl0bGVFbXB0eTogc3RyaW5nO1xyXG4gIEBJbnB1dCgpIGhlYWRlcjogYW55O1xyXG4gIEBJbnB1dCgpIGRhdGEkOiBhbnk7XHJcbiAgQElucHV0KCkgZm9vdGVyQ29uZmlnOiBhbnk7XHJcbiAgQElucHV0KCkgcmVjdXJzb3M6IGFueTtcclxuICBASW5wdXQoKSBhY3Rpb25TdGF0ZTogYW55O1xyXG4gIEBJbnB1dCgpIG9wT2N1bHRhckZvb3RlcjogYm9vbGVhbjtcclxuICBASW5wdXQoKSBoaWRkZW5BY3Rpb25zOiBib29sZWFuO1xyXG4gIEBJbnB1dCgpIGlzTG9hZGluZz86IGJvb2xlYW47XHJcbiAgQElucHV0KCkgcGFnaW5hY2lvbj86IGJvb2xlYW4gPSBmYWxzZTtcclxuICBASW5wdXQoKSB0b3RhbFJlZ2lzdHJvcz86IG51bWJlciA9IDA7XHJcbiAgQElucHV0KCkgYWN0dWFsUGFnZT86IG51bWJlciA9IDA7XHJcbiAgQElucHV0KCkgbXVsdEZQUD86IG51bWJlciA9IDA7XHJcbiAgQE91dHB1dCgpIG9uTmV4dCA9IG5ldyBFdmVudEVtaXR0ZXI8YW55PigpO1xyXG4gIEBPdXRwdXQoKSBvblJldHVybiA9IG5ldyBFdmVudEVtaXR0ZXI8YW55PigpO1xyXG4gIEBPdXRwdXQoKSBvbkRlbGV0ZSA9IG5ldyBFdmVudEVtaXR0ZXI8YW55PigpO1xyXG4gIEBPdXRwdXQoKSBvblVwZGF0ZSA9IG5ldyBFdmVudEVtaXR0ZXI8YW55PigpO1xyXG4gIEBPdXRwdXQoKSBvbkFjdGl2ZSA9IG5ldyBFdmVudEVtaXR0ZXI8YW55PigpO1xyXG4gIEBPdXRwdXQoKSBvblNob3cgPSBuZXcgRXZlbnRFbWl0dGVyPGFueT4oKTtcclxuICBAT3V0cHV0KCkgb25TaG93RXZlbnQgPSBuZXcgRXZlbnRFbWl0dGVyPGFueT4oKTtcclxuICBmb290ZXJSb3cgPSBbXTtcclxuICBvcmRlckhlYWRlclN0YXR1czogQXJyYXk8Ym9vbGVhbj47XHJcbiAgZGF0YVBlcm0kID0gbmV3IEFycmF5PGFueT4oKTtcclxuICBvYnNlcnZhYmxlQnRuRGVsZXRlJDogYm9vbGVhbiA9IGZhbHNlO1xyXG4gIG9ic2VydmFibGVCdG5VcGRhdGUkOiBib29sZWFuID0gZmFsc2U7XHJcbiAgb2JzZXJ2YWJsZUJ0bkFjdGl2ZTogYm9vbGVhbiA9IGZhbHNlO1xyXG4gIGZpbGFzOiBBcnJheTxhbnk+ID0gW107XHJcbiAgZmlsYXNQb3JQYWdpbmE6IG51bWJlciA9IDA7XHJcblxyXG4gIGNvbnN0cnVjdG9yKHByaXZhdGUgY3VycmVuY3lQaXBlOiBDdXJyZW5jeVBpcGUpIHt9XHJcblxyXG4gIG5nT25DaGFuZ2VzKGNoYW5nZXM6IFNpbXBsZUNoYW5nZXMpOiB2b2lkIHtcclxuICAgIGNvbnN0IHsgZGF0YSQsIHJlY3Vyc29zIH0gPSBjaGFuZ2VzO1xyXG4gICAgaWYgKGRhdGEkPy5jdXJyZW50VmFsdWUgIT09IGRhdGEkPy5wcmV2aW91c1ZhbHVlKSB7XHJcbiAgICAgIHRoaXMuZGF0YVBlcm0kID0gZGF0YSQ/LmN1cnJlbnRWYWx1ZTtcclxuICAgIH1cclxuXHJcbiAgICBpZiAocmVjdXJzb3M/LmN1cnJlbnRWYWx1ZSAhPT0gcmVjdXJzb3M/LnByZXZpb3VzVmFsdWUpIHtcclxuICAgICAgdGhpcy5vYnNlcnZhYmxlQnRuVXBkYXRlJCA9IHRoaXMucmVjdXJzb3MudXBkYXRlO1xyXG4gICAgICB0aGlzLm9ic2VydmFibGVCdG5EZWxldGUkID0gdGhpcy5yZWN1cnNvcy5kZWxldGU7XHJcbiAgICAgIHRoaXMub2JzZXJ2YWJsZUJ0bkFjdGl2ZSA9IHRoaXMucmVjdXJzb3MuYWN0aXZlO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgbmdPbkluaXQoKSB7XHJcbiAgICB0aGlzLm9yZGVySGVhZGVyU3RhdHVzID0gdGhpcy5oZWFkZXIubWFwKChoKSA9PiBmYWxzZSk7XHJcbiAgICBpZiAodGhpcy5wYWdpbmFjaW9uICYmIHRoaXMubXVsdEZQUCAhPSAwKSB7XHJcbiAgICAgIHRoaXMuY2FsY0ZpbGFzUG9yUGFnaW5hKCk7XHJcbiAgICB9IGVsc2UgaWYgKHRoaXMucGFnaW5hY2lvbiAmJiB0aGlzLm11bHRGUFAgPT09IDApIHtcclxuICAgICAgdGhpcy5maWxhc1BvclBhZ2luYSA9IDEwO1xyXG4gICAgICB0aGlzLmZpbGFzLnB1c2goMTApO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgY2FsY0ZpbGFzUG9yUGFnaW5hKCkge1xyXG4gICAgbGV0IGNhbnRpZGFkRmlsYXMgPSAwO1xyXG4gICAgZm9yIChsZXQgaW5kZXggPSAwOyBpbmRleCA8IDEwOyBpbmRleCsrKSB7XHJcbiAgICAgIGNhbnRpZGFkRmlsYXMgPSBjYW50aWRhZEZpbGFzICsgdGhpcy5tdWx0RlBQO1xyXG4gICAgICB0aGlzLmZpbGFzLnB1c2goY2FudGlkYWRGaWxhcyk7XHJcbiAgICB9XHJcbiAgICB0aGlzLmZpbGFzUG9yUGFnaW5hID0gdGhpcy5maWxhc1swXTtcclxuICB9XHJcblxyXG4gIHBhZ2luYVNpZ3VpZW50ZSgpIHtcclxuICAgIHRoaXMub25OZXh0LmVtaXQodGhpcy5maWxhc1BvclBhZ2luYSk7XHJcbiAgfVxyXG4gIHBhZ2luYUFudGVyaW9yKCkge1xyXG4gICAgdGhpcy5vblJldHVybi5lbWl0KHRoaXMuZmlsYXNQb3JQYWdpbmEpO1xyXG4gIH1cclxuXHJcbiAgb25PcmRlckNvbHVtbihoZWFkOiBhbnksIGluZGV4OiBudW1iZXIpIHtcclxuICAgIGNvbnN0IG9yZGVyU3RhdHVzID0gdGhpcy5vcmRlckhlYWRlclN0YXR1c1tpbmRleF07XHJcbiAgICB0aGlzLm9yZGVySGVhZGVyU3RhdHVzW2luZGV4XSA9ICFvcmRlclN0YXR1cztcclxuICAgIHRoaXMuZGF0YSQgPSB0aGlzLmRhdGFQZXJtJC5zb3J0KChfLCBiKSA9PiB7XHJcbiAgICAgIGlmICh0eXBlb2YgX1tpbmRleF0gPT09ICdvYmplY3QnKSB7XHJcbiAgICAgICAgaWYgKF9baW5kZXhdLnRpdGxlKSB7XHJcbiAgICAgICAgICBpZiAoX1tpbmRleF0udGl0bGUgPiBiW2luZGV4XS50aXRsZSkge1xyXG4gICAgICAgICAgICByZXR1cm4gb3JkZXJTdGF0dXMgPyAxIDogLTE7XHJcbiAgICAgICAgICB9XHJcbiAgICAgICAgICBpZiAoX1tpbmRleF0udGl0bGUgPCBiW2luZGV4XS50aXRsZSkge1xyXG4gICAgICAgICAgICByZXR1cm4gb3JkZXJTdGF0dXMgPyAtMSA6IDE7XHJcbiAgICAgICAgICB9XHJcbiAgICAgICAgICByZXR1cm4gMDtcclxuICAgICAgICB9XHJcbiAgICAgICAgaWYgKGJbaW5kZXhdLnN1YnRpdGxlKSB7XHJcbiAgICAgICAgICBpZiAoX1tpbmRleF0uc3VidGl0bGUgPiBiW2luZGV4XS5zdWJ0aXRsZSkge1xyXG4gICAgICAgICAgICByZXR1cm4gb3JkZXJTdGF0dXMgPyAxIDogLTE7XHJcbiAgICAgICAgICB9XHJcbiAgICAgICAgICBpZiAoX1tpbmRleF0uc3VidGl0bGUgPCBiW2luZGV4XS5zdWJ0aXRsZSkge1xyXG4gICAgICAgICAgICByZXR1cm4gb3JkZXJTdGF0dXMgPyAtMSA6IDE7XHJcbiAgICAgICAgICB9XHJcbiAgICAgICAgICByZXR1cm4gMDtcclxuICAgICAgICB9XHJcbiAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgaWYgKF9baW5kZXhdID4gYltpbmRleF0pIHtcclxuICAgICAgICAgIHJldHVybiBvcmRlclN0YXR1cyA/IDEgOiAtMTtcclxuICAgICAgICB9XHJcbiAgICAgICAgaWYgKF9baW5kZXhdIDwgYltpbmRleF0pIHtcclxuICAgICAgICAgIHJldHVybiBvcmRlclN0YXR1cyA/IC0xIDogMTtcclxuICAgICAgICB9XHJcbiAgICAgICAgcmV0dXJuIDA7XHJcbiAgICAgIH1cclxuICAgIH0pO1xyXG4gIH1cclxuXHJcbiAgZ2V0Rm9vdGVyRGF0YSgpIHtcclxuICAgIGNvbnN0IHtcclxuICAgICAgY3VzdG9tVG90YWxUaXRsZSxcclxuICAgICAgY3VzdG9tVG90YWxSb3dzLFxyXG4gICAgICBjdXN0b21Ub3RhbEZvcm1hdHRpbmcsXHJcbiAgICAgIGN1c3RvbVRvdGFsVHlwZSxcclxuICAgICAgY3VzdG9tVG90YWxBbGlnbixcclxuICAgICAgY3VzdG9tVG90YWxGaXhlZCxcclxuICAgICAgY3VzdG9tT3BlcmF0aW9uRm9ybWF0dGluZyxcclxuICAgIH0gPSB0aGlzLmZvb3RlckNvbmZpZztcclxuXHJcbiAgICBsZXQgdGFibGVGb290ZXJEYXRhID0gW107XHJcbiAgICBsZXQgcmF3RGF0YSA9IFtdO1xyXG5cclxuICAgIHRoaXMuZGF0YSQ/LmZvckVhY2goKGl0ZW1BcnJheSkgPT4ge1xyXG4gICAgICBsZXQgcmF3RGF0YVJvdyA9IFtdO1xyXG5cclxuICAgICAgLy8gU3RlcCAxOiBmb3JtYXQgLSBwcmVwYXJlIGRhdFxyXG4gICAgICBjb25zdCBmb3JtYXRlZERhdGEgPSBpdGVtQXJyYXkubWFwKChpdGVtKSA9PlxyXG4gICAgICAgIHRoaXMuZ2V0Rm9ybWF0RGF0YVRvVHJlYXRtZW50KGl0ZW0pXHJcbiAgICAgICk7XHJcblxyXG4gICAgICAvLyBTdGVwIDI6IEdldCByYXcgZGF0YSAodmFsdWVzIHRvIHRvdGFscylcclxuICAgICAgdGhpcy5nZXRSYXdEYXRhKFxyXG4gICAgICAgIGN1c3RvbVRvdGFsUm93cyxcclxuICAgICAgICBmb3JtYXRlZERhdGEsXHJcbiAgICAgICAgY3VzdG9tVG90YWxUeXBlLFxyXG4gICAgICAgIHJhd0RhdGFSb3dcclxuICAgICAgKTtcclxuXHJcbiAgICAgIHJhd0RhdGEucHVzaChyYXdEYXRhUm93KTtcclxuICAgIH0pO1xyXG5cclxuICAgIGlmIChjdXN0b21Ub3RhbFJvd3MgJiYgY3VzdG9tVG90YWxSb3dzLmxlbmd0aCAmJiByYXdEYXRhLmxlbmd0aCkge1xyXG4gICAgICBsZXQgcHJvY2VzZWRUb3RhbHMgPSBbXTtcclxuXHJcbiAgICAgIHN3aXRjaCAoY3VzdG9tT3BlcmF0aW9uRm9ybWF0dGluZykge1xyXG4gICAgICAgIGNhc2UgT3BlcmF0aW9uRm9ybWF0LlJFUzpcclxuICAgICAgICAgIHByb2Nlc2VkVG90YWxzID0gdGhpcy50cmFzcG9zZU1hdHJpeChyYXdEYXRhKS5tYXAoKGl0ZW1BcnJheSkgPT4ge1xyXG4gICAgICAgICAgICByZXR1cm4gaXRlbUFycmF5LnJlZHVjZSgoYSwgYikgPT4gYSAtIGIpO1xyXG4gICAgICAgICAgfSk7XHJcbiAgICAgICAgICBicmVhaztcclxuICAgICAgICBkZWZhdWx0OlxyXG4gICAgICAgICAgcHJvY2VzZWRUb3RhbHMgPSB0aGlzLnRyYXNwb3NlTWF0cml4KHJhd0RhdGEpLm1hcCgoaXRlbUFycmF5KSA9PlxyXG4gICAgICAgICAgICBpdGVtQXJyYXkucmVkdWNlKChhLCBiKSA9PiBhICsgYiwgMClcclxuICAgICAgICAgICk7XHJcbiAgICAgICAgICBicmVhaztcclxuICAgICAgfVxyXG5cclxuICAgICAgaWYgKGN1c3RvbVRvdGFsRm9ybWF0dGluZyAmJiBjdXN0b21Ub3RhbEZvcm1hdHRpbmcubGVuZ3RoKSB7XHJcbiAgICAgICAgcHJvY2VzZWRUb3RhbHMgPSBjdXN0b21Ub3RhbEZvcm1hdHRpbmcubWFwKChmb3JtYXQsIGluZGV4KSA9PiB7XHJcbiAgICAgICAgICBsZXQgdmFsdWUsIGFsaWduLCBmaXhlZCwgbGVzcztcclxuXHJcbiAgICAgICAgICBzd2l0Y2ggKGZvcm1hdCkge1xyXG4gICAgICAgICAgICBjYXNlIE51bWJlckZvcm1hdC5DVVI6XHJcbiAgICAgICAgICAgICAgdmFsdWUgPSB0aGlzLmN1cnJlbmN5UGlwZS50cmFuc2Zvcm0ocHJvY2VzZWRUb3RhbHNbaW5kZXhdKTtcclxuICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgZGVmYXVsdDpcclxuICAgICAgICAgICAgICB2YWx1ZSA9IHByb2Nlc2VkVG90YWxzW2luZGV4XTtcclxuICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICBhbGlnbiA9IGN1c3RvbVRvdGFsQWxpZ25baW5kZXhdO1xyXG4gICAgICAgICAgZml4ZWQgPSBjdXN0b21Ub3RhbEZpeGVkW2luZGV4XTtcclxuICAgICAgICAgIGxlc3MgPSBwcm9jZXNlZFRvdGFsc1tpbmRleF0gPD0gLTE7XHJcblxyXG4gICAgICAgICAgcmV0dXJuIHtcclxuICAgICAgICAgICAgdmFsdWUsXHJcbiAgICAgICAgICAgIGFsaWduLFxyXG4gICAgICAgICAgICBmaXhlZCxcclxuICAgICAgICAgICAgbGVzcyxcclxuICAgICAgICAgIH07XHJcbiAgICAgICAgfSk7XHJcbiAgICAgIH1cclxuXHJcbiAgICAgIHRhYmxlRm9vdGVyRGF0YSA9IHByb2Nlc2VkVG90YWxzLmxlbmd0aCA/IHByb2Nlc2VkVG90YWxzIDogbnVsbDtcclxuICAgIH1cclxuXHJcbiAgICBsZXQgZmluYWxGb290ZXJEYXRhID0gW107XHJcblxyXG4gICAgLy8gQ2xlYXIgZGF0YVxyXG4gICAgaWYgKGN1c3RvbVRvdGFsUm93cyAmJiBjdXN0b21Ub3RhbFJvd3MubGVuZ3RoKSB7XHJcbiAgICAgIGxldCBjb250ID0gMDtcclxuICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCB0aGlzLmhlYWRlci5sZW5ndGg7IGkrKykge1xyXG4gICAgICAgIGxldCBpdGVtVG9QdXNoO1xyXG5cclxuICAgICAgICBjdXN0b21Ub3RhbFJvd3MuZm9yRWFjaCgoY3VzdG9tSW5kZXgpID0+IHtcclxuICAgICAgICAgIGlmIChjdXN0b21JbmRleCA9PT0gaSkge1xyXG4gICAgICAgICAgICBpdGVtVG9QdXNoID0gdGFibGVGb290ZXJEYXRhW2NvbnRdO1xyXG4gICAgICAgICAgICBjb250Kys7XHJcbiAgICAgICAgICB9XHJcbiAgICAgICAgfSk7XHJcblxyXG4gICAgICAgIGlmIChpID09PSAwICYmIGN1c3RvbVRvdGFsVGl0bGUpIHtcclxuICAgICAgICAgIGl0ZW1Ub1B1c2ggPSB7XHJcbiAgICAgICAgICAgIGZpeGVkOiAndGQtc3RpY2t5LWxlZnQgdGl0bGUtdG90YWwnLFxyXG4gICAgICAgICAgICB2YWx1ZTogY3VzdG9tVG90YWxUaXRsZSxcclxuICAgICAgICAgIH07XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBpZiAodGhpcy5oZWFkZXIubGVuZ3RoID09PSBpICsgMSAmJiAhdGhpcy5oaWRkZW5BY3Rpb25zKSB7XHJcbiAgICAgICAgICBpdGVtVG9QdXNoID0geyBmaXhlZDogJ3RkLXN0aWNreS1yaWdodCcgfTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGZpbmFsRm9vdGVyRGF0YS5wdXNoKGl0ZW1Ub1B1c2gpO1xyXG4gICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgdGhpcy5mb290ZXJSb3cgPSBmaW5hbEZvb3RlckRhdGE7XHJcbiAgfVxyXG5cclxuICBmb3JtYXRDdXJyZW5jeVRvTnVtYmVyKHZhbHVlOiBzdHJpbmcpOiBudW1iZXIge1xyXG4gICAgaWYgKHZhbHVlICE9PSB1bmRlZmluZWQgJiYgdmFsdWUgIT09IG51bGwpXHJcbiAgICAgIHJldHVybiBOdW1iZXIoU3RyaW5nKHZhbHVlKS5yZXBsYWNlKC9bXjAtOS4tXSsvZywgJycpKTtcclxuICB9XHJcblxyXG4gIHRyYXNwb3NlTWF0cml4KG1hdHJpeCkge1xyXG4gICAgcmV0dXJuIG1hdHJpeFswXS5tYXAoKF8sIGNvbEluZGV4KSA9PiBtYXRyaXgubWFwKChyb3cpID0+IHJvd1tjb2xJbmRleF0pKTtcclxuICB9XHJcblxyXG4gIHRvZ2dsZUZpbHRlckNsYXNzKGluZGV4OiBudW1iZXIpIHtcclxuICAgIHJldHVybiBgYmkgJHtcclxuICAgICAgdGhpcy5vcmRlckhlYWRlclN0YXR1c1tpbmRleF0gPyAnYmktY2FyZXQtdXAtZmlsbCcgOiAnYmktY2FyZXQtZG93bi1maWxsJ1xyXG4gICAgfSBpY29uLW9yZGVyYDtcclxuICB9XHJcblxyXG4gIGlzT2JqZWN0KHZhbCk6IGJvb2xlYW4ge1xyXG4gICAgcmV0dXJuIHR5cGVvZiB2YWwgPT09ICdvYmplY3QnO1xyXG4gIH1cclxuXHJcbiAgZ2V0UmF3RGF0YShjdXN0b21Ub3RhbFJvd3MsIGZvcm1hdGVkRGF0YSwgY3VzdG9tVG90YWxUeXBlLCByYXdEYXRhUm93KSB7XHJcbiAgICBpZiAoY3VzdG9tVG90YWxSb3dzICYmIGN1c3RvbVRvdGFsUm93cy5sZW5ndGgpIHtcclxuICAgICAgY3VzdG9tVG90YWxSb3dzLmZvckVhY2goKGN1c3RvbUluZGV4LCBpbmRleENvbCkgPT4ge1xyXG4gICAgICAgIGZvcm1hdGVkRGF0YS5mb3JFYWNoKChpdGVtLCBpbmRleCkgPT4ge1xyXG4gICAgICAgICAgaWYgKGN1c3RvbUluZGV4ID09PSBpbmRleCkge1xyXG4gICAgICAgICAgICBsZXQgcmV0dXJuSXRlbSA9IDA7XHJcblxyXG4gICAgICAgICAgICBjdXN0b21Ub3RhbFR5cGUuZm9yRWFjaCgodHlwZSwgaW5kZXhUeXBlKSA9PiB7XHJcbiAgICAgICAgICAgICAgaWYgKGluZGV4Q29sID09PSBpbmRleFR5cGUpIHtcclxuICAgICAgICAgICAgICAgIHN3aXRjaCAodHlwZSkge1xyXG4gICAgICAgICAgICAgICAgICBjYXNlIEZvcm1hdFR5cGUuTlVNOlxyXG4gICAgICAgICAgICAgICAgICAgIGlmIChcclxuICAgICAgICAgICAgICAgICAgICAgICh0eXBlb2YgaXRlbSA9PT0gJ3N0cmluZycgJiZcclxuICAgICAgICAgICAgICAgICAgICAgICAgKGl0ZW0gPT0gJy0tJyB8fCBpdGVtID09PSAnJykpIHx8XHJcbiAgICAgICAgICAgICAgICAgICAgICB0eXBlb2YgaXRlbSA9PT0gJ3VuZGVmaW5lZCdcclxuICAgICAgICAgICAgICAgICAgICApIHtcclxuICAgICAgICAgICAgICAgICAgICAgIHJldHVybkl0ZW0gPSAwO1xyXG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICByZXR1cm5JdGVtID0gTnVtYmVyKGl0ZW0pO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgICAgICAgY2FzZSBGb3JtYXRUeXBlLkNVUjpcclxuICAgICAgICAgICAgICAgICAgICBpZiAoXHJcbiAgICAgICAgICAgICAgICAgICAgICAodHlwZW9mIGl0ZW0gPT09ICdzdHJpbmcnICYmXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIChpdGVtID09ICctLScgfHwgaXRlbSA9PT0gJycpKSB8fFxyXG4gICAgICAgICAgICAgICAgICAgICAgdHlwZW9mIGl0ZW0gPT09ICd1bmRlZmluZWQnXHJcbiAgICAgICAgICAgICAgICAgICAgKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICByZXR1cm5JdGVtID0gMDtcclxuICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgICAgcmV0dXJuSXRlbSA9IHRoaXMuZm9ybWF0Q3VycmVuY3lUb051bWJlcihpdGVtKTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgICAgICAgIGNhc2UgRm9ybWF0VHlwZS5DT1U6XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKFxyXG4gICAgICAgICAgICAgICAgICAgICAgKHR5cGVvZiBpdGVtID09PSAnc3RyaW5nJyAmJlxyXG4gICAgICAgICAgICAgICAgICAgICAgICAoaXRlbSA9PSAnLS0nIHx8IGl0ZW0gPT09ICcnKSkgfHxcclxuICAgICAgICAgICAgICAgICAgICAgIHR5cGVvZiBpdGVtID09PSAndW5kZWZpbmVkJ1xyXG4gICAgICAgICAgICAgICAgICAgICkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgcmV0dXJuSXRlbSA9IDA7XHJcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICAgIHJldHVybkl0ZW0gPSAxO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgICAgICAgZGVmYXVsdDpcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm5JdGVtID0gMDtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICByYXdEYXRhUm93LnB1c2gocmV0dXJuSXRlbSk7XHJcbiAgICAgICAgICB9XHJcbiAgICAgICAgfSk7XHJcbiAgICAgIH0pO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgZ2V0Rm9ybWF0RGF0YVRvVHJlYXRtZW50KGl0ZW0pIHtcclxuICAgIGlmICh0eXBlb2YgaXRlbSA9PT0gJ29iamVjdCcpIHtcclxuICAgICAgaWYgKGl0ZW0gIT0gbnVsbCkge1xyXG4gICAgICAgIGlmIChpdGVtLnRpdGxlICYmIGl0ZW0uc3VidGl0bGUpIHtcclxuICAgICAgICAgIHJldHVybiBgJHtpdGVtLnRpdGxlfVxcbiR7aXRlbS5zdWJ0aXRsZX1gO1xyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICByZXR1cm4gaXRlbS50aXRsZSA/IGl0ZW0udGl0bGUgOiBpdGVtLnN1YnRpdGxlICYmIGl0ZW0uc3VidGl0bGU7XHJcbiAgICAgICAgfVxyXG4gICAgICB9IGVsc2Uge1xyXG4gICAgICAgIHJldHVybiAnJztcclxuICAgICAgfVxyXG4gICAgfSBlbHNlIHtcclxuICAgICAgcmV0dXJuIGl0ZW07XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICBvbkRlbGV0ZUl0ZW0oaXRlbTogYW55KSB7XHJcbiAgICB0aGlzLm9uRGVsZXRlLmVtaXQoaXRlbSk7XHJcbiAgfVxyXG5cclxuICBvbkFjdGl2ZUl0ZW0oaXRlbTogYW55KSB7XHJcbiAgICB0aGlzLm9uQWN0aXZlLmVtaXQoaXRlbSk7XHJcbiAgfVxyXG5cclxuICBvblVwZGF0ZUl0ZW0oaXRlbTogYW55KSB7XHJcbiAgICB0aGlzLm9uVXBkYXRlLmVtaXQoaXRlbSk7XHJcbiAgfVxyXG5cclxuICBvblNob3dJdGVtKGl0ZW06IGFueSwgJGV2ZW50OiBhbnkpIHtcclxuICAgIHRoaXMub25TaG93LmVtaXQoaXRlbSk7XHJcbiAgICB0aGlzLm9uU2hvd0V2ZW50LmVtaXQoJGV2ZW50KTtcclxuICB9XHJcbn1cclxuIl19